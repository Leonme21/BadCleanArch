ê8
CC:\Temp\Parcial4\src\Infrastructure\Repositories\OrderRepository.cs
	namespace		 	
Infrastructure		
 
.		 
Repositories		 %
;		% &
public 
class 
OrderRepository 
: 
IOrderRepository /
{ 
private 
readonly 
string 
_connectionString -
;- .
private 
readonly 
ILogger 
_logger $
;$ %
public 

OrderRepository 
( 
string !
connectionString" 2
,2 3
ILogger4 ;
logger< B
)B C
{ 
_connectionString 
= 
connectionString ,
??- /
throw0 5
new6 9!
ArgumentNullException: O
(O P
nameofP V
(V W
connectionStringW g
)g h
)h i
;i j
_logger 
= 
logger 
?? 
throw !
new" %!
ArgumentNullException& ;
(; <
nameof< B
(B C
loggerC I
)I J
)J K
;K L
} 
public 

async 
Task 
< 
bool 
> 
	SaveAsync %
(% &
Order& +
order, 1
)1 2
{ 
try 
{ 	
using 
var 

connection  
=! "
new# &
SqlConnection' 4
(4 5
_connectionString5 F
)F G
;G H
await 

connection 
. 
	OpenAsync &
(& '
)' (
;( )
const 
string 
sql 
= 
$str Q
;Q R
using!! 
var!! 
command!! 
=!! 
new!!  #

SqlCommand!!$ .
(!!. /
sql!!/ 2
,!!2 3

connection!!4 >
)!!> ?
;!!? @
command## 
.## 

Parameters## 
.## 
AddWithValue## +
(##+ ,
$str##, 1
,##1 2
order##3 8
.##8 9
Id##9 ;
)##; <
;##< =
command$$ 
.$$ 

Parameters$$ 
.$$ 
AddWithValue$$ +
($$+ ,
$str$$, ;
,$$; <
order$$= B
.$$B C
CustomerName$$C O
)$$O P
;$$P Q
command%% 
.%% 

Parameters%% 
.%% 
AddWithValue%% +
(%%+ ,
$str%%, :
,%%: ;
order%%< A
.%%A B
ProductName%%B M
)%%M N
;%%N O
command&& 
.&& 

Parameters&& 
.&& 
AddWithValue&& +
(&&+ ,
$str&&, 7
,&&7 8
order&&9 >
.&&> ?
Quantity&&? G
)&&G H
;&&H I
command'' 
.'' 

Parameters'' 
.'' 
AddWithValue'' +
(''+ ,
$str'', 8
,''8 9
order'': ?
.''? @
	UnitPrice''@ I
)''I J
;''J K
await)) 
command)) 
.))  
ExecuteNonQueryAsync)) .
()). /
)))/ 0
;))0 1
_logger** 
.** 
LogInformation** "
(**" #
$"**# %
$str**% +
{**+ ,
order**, 1
.**1 2
Id**2 4
}**4 5
$str**5 H
"**H I
)**I J
;**J K
return++ 
true++ 
;++ 
},, 	
catch-- 
(-- 
	Exception-- 
ex-- 
)-- 
{.. 	
_logger// 
.// 
LogError// 
(// 
$"// 
$str// 4
{//4 5
order//5 :
.//: ;
Id//; =
}//= >
"//> ?
,//? @
ex//A C
)//C D
;//D E
return00 
false00 
;00 
}11 	
}22 
public77 

async77 
Task77 
<77 
IEnumerable77 !
<77! "
Order77" '
>77' (
>77( )
GetAllAsync77* 5
(775 6
)776 7
{88 
var99 
orders99 
=99 
new99 
List99 
<99 
Order99 #
>99# $
(99$ %
)99% &
;99& '
try;; 
{<< 	
using== 
var== 

connection==  
===! "
new==# &
SqlConnection==' 4
(==4 5
_connectionString==5 F
)==F G
;==G H
await>> 

connection>> 
.>> 
	OpenAsync>> &
(>>& '
)>>' (
;>>( )
const@@ 
string@@ 
sql@@ 
=@@ 
$str@@ f
;@@f g
usingBB 
varBB 
commandBB 
=BB 
newBB  #

SqlCommandBB$ .
(BB. /
sqlBB/ 2
,BB2 3

connectionBB4 >
)BB> ?
;BB? @
usingCC 
varCC 
readerCC 
=CC 
awaitCC $
commandCC% ,
.CC, -
ExecuteReaderAsyncCC- ?
(CC? @
)CC@ A
;CCA B
whileEE 
(EE 
awaitEE 
readerEE 
.EE  
	ReadAsyncEE  )
(EE) *
)EE* +
)EE+ ,
{FF 
ordersGG 
.GG 
AddGG 
(GG 
newGG 
OrderGG $
{HH 
IdII 
=II 
readerII 
.II  
GetInt32II  (
(II( )
$numII) *
)II* +
,II+ ,
CustomerNameJJ  
=JJ! "
readerJJ# )
.JJ) *
	GetStringJJ* 3
(JJ3 4
$numJJ4 5
)JJ5 6
,JJ6 7
ProductNameKK 
=KK  !
readerKK" (
.KK( )
	GetStringKK) 2
(KK2 3
$numKK3 4
)KK4 5
,KK5 6
QuantityLL 
=LL 
readerLL %
.LL% &
GetInt32LL& .
(LL. /
$numLL/ 0
)LL0 1
,LL1 2
	UnitPriceMM 
=MM 
readerMM  &
.MM& '

GetDecimalMM' 1
(MM1 2
$numMM2 3
)MM3 4
}NN 
)NN 
;NN 
}OO 
_loggerQQ 
.QQ 
LogInformationQQ "
(QQ" #
$"QQ# %
$strQQ% /
{QQ/ 0
ordersQQ0 6
.QQ6 7
CountQQ7 <
}QQ< =
$strQQ= R
"QQR S
)QQS T
;QQT U
}RR 	
catchSS 
(SS 
	ExceptionSS 
exSS 
)SS 
{TT 	
_loggerUU 
.UU 
LogErrorUU 
(UU 
$strUU 8
,UU8 9
exUU: <
)UU< =
;UU= >
}VV 	
returnXX 
ordersXX 
;XX 
}YY 
}ZZ 7
5C:\Temp\Parcial4\src\Infrastructure\Logging\Logger.cs¬
<C:\Temp\Parcial4\src\Infrastructure\Logging\ConsoleLogger.cs
	namespace 	
Infrastructure
 
. 
Logging  
;  !
public 
class 
ConsoleLogger 
: 
ILogger $
{ 
private 
readonly 
bool 

_isEnabled $
;$ %
public

 

ConsoleLogger

 
(

 
bool

 
	isEnabled

 '
=

( )
true

* .
)

. /
{ 

_isEnabled 
= 
	isEnabled 
; 
} 
public 

void 
LogInformation 
( 
string %
message& -
)- .
{ 
if 

( 
! 

_isEnabled 
) 
return 
;  
Console 
. 
	WriteLine 
( 
$" 
$str #
{# $
DateTime$ ,
., -
UtcNow- 3
:3 4
$str4 G
}G H
$strH K
{K L
messageL S
}S T
"T U
)U V
;V W
} 
public 

void 

LogWarning 
( 
string !
message" )
)) *
{ 
if 

( 
! 

_isEnabled 
) 
return 
;  
Console 
. 
ForegroundColor 
=  !
ConsoleColor" .
.. /
Yellow/ 5
;5 6
Console 
. 
	WriteLine 
( 
$" 
$str #
{# $
DateTime$ ,
., -
UtcNow- 3
:3 4
$str4 G
}G H
$strH K
{K L
messageL S
}S T
"T U
)U V
;V W
Console 
. 

ResetColor 
( 
) 
; 
} 
public 

void 
LogError 
( 
string 
message  '
,' (
	Exception) 2
	exception3 <
== >
null? C
)C D
{   
if!! 

(!! 
!!! 

_isEnabled!! 
)!! 
return!! 
;!!  
Console## 
.## 
ForegroundColor## 
=##  !
ConsoleColor##" .
.##. /
Red##/ 2
;##2 3
Console$$ 
.$$ 
	WriteLine$$ 
($$ 
$"$$ 
$str$$ $
{$$$ %
DateTime$$% -
.$$- .
UtcNow$$. 4
:$$4 5
$str$$5 H
}$$H I
$str$$I L
{$$L M
message$$M T
}$$T U
"$$U V
)$$V W
;$$W X
if&& 

(&& 
	exception&& 
!=&& 
null&& 
)&& 
{'' 	
Console(( 
.(( 
	WriteLine(( 
((( 
$"((  
$str((  +
{((+ ,
	exception((, 5
.((5 6
Message((6 =
}((= >
"((> ?
)((? @
;((@ A
Console)) 
.)) 
	WriteLine)) 
()) 
$"))  
$str))  ,
{)), -
	exception))- 6
.))6 7

StackTrace))7 A
}))A B
"))B C
)))C D
;))D E
}** 	
Console,, 
.,, 

ResetColor,, 
(,, 
),, 
;,, 
}-- 
}.. 3
1C:\Temp\Parcial4\src\Infrastructure\Data\BadDb.cs