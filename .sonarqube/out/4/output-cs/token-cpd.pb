…O
&C:\Temp\Parcial4\src\WebApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddCors

 
(

 
options

  
=>

! #
options

$ +
.

+ ,
	AddPolicy

, 5
(

5 6
$str

6 L
,

L M
policy

N T
=>

U W
{ 
policy 

.
 
WithOrigins 
( 
$str .
,. /
$str0 H
)H I
.
 
AllowAnyHeader 
( 
) 
.
 
AllowAnyMethod 
( 
) 
; 
} 
) 
) 
; 
var 
connectionString 
= 
builder 
. 
Configuration ,
., -
GetConnectionString- @
(@ A
$strA F
)F G
?? 
builder 
. 
Configuration 
[ 
$str 4
]4 5
?? 
throw 
new %
InvalidOperationException *
(* +
$str+ S
)S T
;T U
builder 
. 
Services 
. 
AddSingleton 
< 
OrderService *
>* +
(+ ,
), -
;- .
builder 
. 
Services 
. 
AddSingleton 
< 
DomainLogger *
>* +
(+ ,
new, /
ConsoleLogger0 =
(= >
	isEnabled> G
:G H
trueI M
)M N
)N O
;O P
builder 
. 
Services 
. 
AddSingleton 
< !
DomainOrderRepository 3
>3 4
(4 5
sp5 7
=>8 :
new 
OrderRepository 
( 
connectionString (
,( )
sp* ,
., -
GetRequiredService- ?
<? @
DomainLogger@ L
>L M
(M N
)N O
)O P
)P Q
;Q R
builder 
. 
Services 
. 
	AddScoped 
< 
CreateOrderUseCase -
>- .
(. /
)/ 0
;0 1
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
app 
. 
UseCors 
( 
$str "
)" #
;# $
app 
. 
UseExceptionHandler 
( 
errorApp  
=>! #
{   
errorApp!! 
.!! 
Run!! 
(!! 
async!! 
context!! 
=>!! !
{"" 
context## 
.## 
Response## 
.## 

StatusCode## #
=##$ %
$num##& )
;##) *
context$$ 
.$$ 
Response$$ 
.$$ 
ContentType$$ $
=$$% &
$str$$' 9
;$$9 :
var&& 
logger&& 
=&& 
context&& 
.&& 
RequestServices&& ,
.&&, -
GetRequiredService&&- ?
<&&? @
DomainLogger&&@ L
>&&L M
(&&M N
)&&N O
;&&O P
logger'' 
.'' 
LogError'' 
('' 
$str'' 6
,''6 7
null''8 <
)''< =
;''= >
await)) 
context)) 
.)) 
Response)) 
.)) 
WriteAsJsonAsync)) /
())/ 0
new))0 3
{))4 5
error))6 ;
=))< =
$str))> i
}))j k
)))k l
;))l m
}** 
)** 
;** 
}++ 
)++ 
;++ 
app-- 
.-- 
MapGet-- 

(--
 
$str-- 
,-- 
(-- 
DomainLogger-- #
logger--$ *
)--* +
=>--, .
{.. 
logger// 

.//
 
LogInformation// 
(// 
$str// 2
)//2 3
;//3 4
return00 

Results00 
.00 
Ok00 
(00 
new00 
{00 
status00 "
=00# $
$str00% .
,00. /
	timestamp000 9
=00: ;
DateTime00< D
.00D E
UtcNow00E K
}00L M
)00M N
;00N O
}11 
)11 
;11 
app33 
.33 
MapPost33 
(33 
$str33 
,33 
async33 
(33 
CreateOrderRequest33 0
request331 8
,338 9
CreateOrderUseCase33: L
useCase33M T
,33T U
DomainLogger33V b
logger33c i
)33i j
=>33k m
{44 
try55 
{66 
if77 

(77 
request77 
==77 
null77 
)77 
{88 	
return99 
Results99 
.99 

BadRequest99 %
(99% &
new99& )
{99* +
error99, 1
=992 3
$str994 N
}99O P
)99P Q
;99Q R
}:: 	
var<< 
order<< 
=<< 
await<< 
useCase<< !
.<<! "
ExecuteAsync<<" .
(<<. /
request== 
.== 
CustomerName==  
,==  !
request>> 
.>> 
ProductName>> 
,>>  
request?? 
.?? 
Quantity?? 
,?? 
request@@ 
.@@ 
	UnitPrice@@ 
)@@ 
;@@ 
returnBB 
ResultsBB 
.BB 
OkBB 
(BB 
newBB 
{CC 	
idDD 
=DD 
orderDD 
.DD 
IdDD 
,DD 
customerNameEE 
=EE 
orderEE  
.EE  !
CustomerNameEE! -
,EE- .
productNameFF 
=FF 
orderFF 
.FF  
ProductNameFF  +
,FF+ ,
quantityGG 
=GG 
orderGG 
.GG 
QuantityGG %
,GG% &
	unitPriceHH 
=HH 
orderHH 
.HH 
	UnitPriceHH '
,HH' (
totalII 
=II 
orderII 
.II 
CalculateTotalII (
(II( )
)II) *
}JJ 	
)JJ	 

;JJ
 
}KK 
catchLL 	
(LL
 
ArgumentExceptionLL 
exLL 
)LL  
{MM 
loggerNN 
.NN 

LogWarningNN 
(NN 
$"NN 
$strNN 3
{NN3 4
exNN4 6
.NN6 7
MessageNN7 >
}NN> ?
"NN? @
)NN@ A
;NNA B
returnOO 
ResultsOO 
.OO 

BadRequestOO !
(OO! "
newOO" %
{OO& '
errorOO( -
=OO. /
exOO0 2
.OO2 3
MessageOO3 :
}OO; <
)OO< =
;OO= >
}PP 
catchQQ 	
(QQ
 
	ExceptionQQ 
exQQ 
)QQ 
{RR 
loggerSS 
.SS 
LogErrorSS 
(SS 
$strSS .
,SS. /
exSS0 2
)SS2 3
;SS3 4
returnTT 
ResultsTT 
.TT 
ProblemTT 
(TT 
$strTT K
)TTK L
;TTL M
}UU 
}VV 
)VV 
;VV 
appXX 
.XX 
MapGetXX 

(XX
 
$strXX 
,XX 
asyncXX 
(XX !
DomainOrderRepositoryXX 2

repositoryXX3 =
,XX= >
DomainLoggerXX? K
loggerXXL R
)XXR S
=>XXT V
{YY 
tryZZ 
{[[ 
var\\ 
orders\\ 
=\\ 
await\\ 

repository\\ %
.\\% &
GetAllAsync\\& 1
(\\1 2
)\\2 3
;\\3 4
return]] 
Results]] 
.]] 
Ok]] 
(]] 
orders]]  
)]]  !
;]]! "
}^^ 
catch__ 	
(__
 
	Exception__ 
ex__ 
)__ 
{`` 
loggeraa 
.aa 
LogErroraa 
(aa 
$straa 1
,aa1 2
exaa3 5
)aa5 6
;aa6 7
returnbb 
Resultsbb 
.bb 
Problembb 
(bb 
$strbb J
)bbJ K
;bbK L
}cc 
}dd 
)dd 
;dd 
appff 
.ff 
MapGetff 

(ff
 
$strff 
,ff 
(ff 
)ff 
=>ff 
newff 
{gg 
versionhh 
=hh 
$strhh 
,hh 
environmentii 
=ii 
builderii 
.ii 
Environmentii %
.ii% &
EnvironmentNameii& 5
,ii5 6
	timestampjj 
=jj 
DateTimejj 
.jj 
UtcNowjj 
}kk 
)kk 
;kk 
appmm 
.mm 
Runmm 
(mm 
)mm 	
;mm	 

publicoo 
recordoo 
CreateOrderRequestoo  
(oo  !
stringpp 

CustomerNamepp 
,pp 
stringqq 

ProductNameqq 
,qq 
intrr 
Quantityrr 
,rr 
decimalss 
	UnitPricess 
)tt 
;tt ™
;C:\Temp\Parcial4\src\WebApi\Controllers\OrdersController.cs
	namespace 	
WebApi
 
. 
Controllers 
{ 
public 

class 
OrdersController !
{ 
public 
string 
	DoNothing 
(  
)  !
=>" $
$str% `
;` a
} 
}		 