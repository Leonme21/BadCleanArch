=
;C:\Temp\Parcial4\src\WebApi\Controllers\OrdersController.cs’T
&C:\Temp\Parcial4\src\WebApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddCors

 
(

 
options

  
=>

! #
options

$ +
.

+ ,
	AddPolicy

, 5
(

5 6
$str

6 L
,

L M
policy

N T
=>

U W
{ 
policy 

.
 
WithOrigins 
( 
$str .
,. /
$str0 H
)H I
.
 
AllowAnyHeader 
( 
) 
.
 
AllowAnyMethod 
( 
) 
; 
} 
) 
) 
; 
var 
connectionString 
= 
builder 
. 
Configuration ,
., -
GetConnectionString- @
(@ A
$strA F
)F G
?? 
builder 
. 
Configuration 
[ 
$str 4
]4 5
?? 
throw 
new %
InvalidOperationException *
(* +
$str+ S
)S T
;T U
if 
( 
! 
string 
. 
IsNullOrEmpty 
( 
Environment %
.% &"
GetEnvironmentVariable& <
(< =
$str= J
)J K
)K L
)L M
{ 
connectionString 
= 
connectionString '
.' (
Replace( /
(/ 0
$str0 @
,@ A
EnvironmentB M
.M N"
GetEnvironmentVariableN d
(d e
$stre r
)r s
!s t
)t u
;u v
} 
builder 
. 
Services 
. 
AddSingleton 
< 
OrderService *
>* +
(+ ,
), -
;- .
builder 
. 
Services 
. 
AddSingleton 
< 
DomainLogger *
>* +
(+ ,
new, /
ConsoleLogger0 =
(= >
	isEnabled> G
:G H
trueI M
)M N
)N O
;O P
builder 
. 
Services 
. 
AddSingleton 
< !
DomainOrderRepository 3
>3 4
(4 5
sp5 7
=>8 :
new 
OrderRepository 
( 
connectionString (
,( )
sp* ,
., -
GetRequiredService- ?
<? @
DomainLogger@ L
>L M
(M N
)N O
)O P
)P Q
;Q R
builder 
. 
Services 
. 
	AddScoped 
< 
CreateOrderUseCase -
>- .
(. /
)/ 0
;0 1
var!! 
app!! 
=!! 	
builder!!
 
.!! 
Build!! 
(!! 
)!! 
;!! 
app## 
.## 
UseCors## 
(## 
$str## "
)##" #
;### $
app%% 
.%% 
UseExceptionHandler%% 
(%% 
errorApp%%  
=>%%! #
{&& 
errorApp'' 
.'' 
Run'' 
('' 
async'' 
context'' 
=>'' !
{(( 
context)) 
.)) 
Response)) 
.)) 

StatusCode)) #
=))$ %
$num))& )
;))) *
context** 
.** 
Response** 
.** 
ContentType** $
=**% &
$str**' 9
;**9 :
var,, 
logger,, 
=,, 
context,, 
.,, 
RequestServices,, ,
.,,, -
GetRequiredService,,- ?
<,,? @
DomainLogger,,@ L
>,,L M
(,,M N
),,N O
;,,O P
logger-- 
.-- 
LogError-- 
(-- 
$str-- 6
,--6 7
null--8 <
)--< =
;--= >
await// 
context// 
.// 
Response// 
.// 
WriteAsJsonAsync// /
(/// 0
new//0 3
{//4 5
error//6 ;
=//< =
$str//> i
}//j k
)//k l
;//l m
}00 
)00 
;00 
}11 
)11 
;11 
app33 
.33 
MapGet33 

(33
 
$str33 
,33 
(33 
DomainLogger33 #
logger33$ *
)33* +
=>33, .
{44 
logger55 

.55
 
LogInformation55 
(55 
$str55 2
)552 3
;553 4
return66 

Results66 
.66 
Ok66 
(66 
new66 
{66 
status66 "
=66# $
$str66% .
,66. /
	timestamp660 9
=66: ;
DateTime66< D
.66D E
UtcNow66E K
}66L M
)66M N
;66N O
}77 
)77 
;77 
app99 
.99 
MapPost99 
(99 
$str99 
,99 
async99 
(99 
CreateOrderRequest99 0
request991 8
,998 9
CreateOrderUseCase99: L
useCase99M T
,99T U
DomainLogger99V b
logger99c i
)99i j
=>99k m
{:: 
try;; 
{<< 
if== 

(== 
request== 
==== 
null== 
)== 
{>> 	
return?? 
Results?? 
.?? 

BadRequest?? %
(??% &
new??& )
{??* +
error??, 1
=??2 3
$str??4 N
}??O P
)??P Q
;??Q R
}@@ 	
varBB 
orderBB 
=BB 
awaitBB 
useCaseBB !
.BB! "
ExecuteAsyncBB" .
(BB. /
requestCC 
.CC 
CustomerNameCC  
,CC  !
requestDD 
.DD 
ProductNameDD 
,DD  
requestEE 
.EE 
QuantityEE 
,EE 
requestFF 
.FF 
	UnitPriceFF 
)FF 
;FF 
returnHH 
ResultsHH 
.HH 
OkHH 
(HH 
newHH 
{II 	
idJJ 
=JJ 
orderJJ 
.JJ 
IdJJ 
,JJ 
customerNameKK 
=KK 
orderKK  
.KK  !
CustomerNameKK! -
,KK- .
productNameLL 
=LL 
orderLL 
.LL  
ProductNameLL  +
,LL+ ,
quantityMM 
=MM 
orderMM 
.MM 
QuantityMM %
,MM% &
	unitPriceNN 
=NN 
orderNN 
.NN 
	UnitPriceNN '
,NN' (
totalOO 
=OO 
orderOO 
.OO 
CalculateTotalOO (
(OO( )
)OO) *
}PP 	
)PP	 

;PP
 
}QQ 
catchRR 	
(RR
 
ArgumentExceptionRR 
exRR 
)RR  
{SS 
loggerTT 
.TT 

LogWarningTT 
(TT 
$"TT 
$strTT 3
{TT3 4
exTT4 6
.TT6 7
MessageTT7 >
}TT> ?
"TT? @
)TT@ A
;TTA B
returnUU 
ResultsUU 
.UU 

BadRequestUU !
(UU! "
newUU" %
{UU& '
errorUU( -
=UU. /
exUU0 2
.UU2 3
MessageUU3 :
}UU; <
)UU< =
;UU= >
}VV 
catchWW 	
(WW
 
	ExceptionWW 
exWW 
)WW 
{XX 
loggerYY 
.YY 
LogErrorYY 
(YY 
$strYY .
,YY. /
exYY0 2
)YY2 3
;YY3 4
returnZZ 
ResultsZZ 
.ZZ 
ProblemZZ 
(ZZ 
$strZZ K
)ZZK L
;ZZL M
}[[ 
}\\ 
)\\ 
;\\ 
app^^ 
.^^ 
MapGet^^ 

(^^
 
$str^^ 
,^^ 
async^^ 
(^^ !
DomainOrderRepository^^ 2

repository^^3 =
,^^= >
DomainLogger^^? K
logger^^L R
)^^R S
=>^^T V
{__ 
try`` 
{aa 
varbb 
ordersbb 
=bb 
awaitbb 

repositorybb %
.bb% &
GetAllAsyncbb& 1
(bb1 2
)bb2 3
;bb3 4
returncc 
Resultscc 
.cc 
Okcc 
(cc 
orderscc  
)cc  !
;cc! "
}dd 
catchee 	
(ee
 
	Exceptionee 
exee 
)ee 
{ff 
loggergg 
.gg 
LogErrorgg 
(gg 
$strgg 1
,gg1 2
exgg3 5
)gg5 6
;gg6 7
returnhh 
Resultshh 
.hh 
Problemhh 
(hh 
$strhh J
)hhJ K
;hhK L
}ii 
}jj 
)jj 
;jj 
appll 
.ll 
MapGetll 

(ll
 
$strll 
,ll 
(ll 
)ll 
=>ll 
newll 
{mm 
versionnn 
=nn 
$strnn 
,nn 
environmentoo 
=oo 
builderoo 
.oo 
Environmentoo %
.oo% &
EnvironmentNameoo& 5
,oo5 6
	timestamppp 
=pp 
DateTimepp 
.pp 
UtcNowpp 
}qq 
)qq 
;qq 
awaitss 
appss 	
.ss	 

RunAsyncss
 
(ss 
)ss 
;ss 
publicvv 
recordvv 
CreateOrderRequestvv  
(vv  !
stringww 

CustomerNameww 
,ww 
stringxx 

ProductNamexx 
,xx 
intyy 
Quantityyy 
,yy 
decimalzz 
	UnitPricezz 
){{ 
;{{ 